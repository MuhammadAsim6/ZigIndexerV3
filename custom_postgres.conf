# ------------------------------------------------------------------------------
# ðŸ›°ï¸ ZIGCHAIN INDEXER - OPTIMIZED POSTGRESQL CONFIGURATION
# ------------------------------------------------------------------------------

# REPLICATION & LOGICAL DECODING
wal_level = logical               # Required for logical decoding
max_replication_slots = 20        # Set to > number of subscriptions (14 schemas + reserve)
max_wal_senders = 20              # Concurrent processes for streaming WAL
wal_sender_timeout = 0            # Disable timeout for long-running blockchain syncs

# WAL SIZE & RETENTION
# Maximum WAL to keep for slots. -1 allows unlimited growth (use with monitoring)
max_slot_wal_keep_size = -1
# Total WAL size on disk. Set high (e.g., 50GB-100GB) to handle indexing bursts
max_wal_size = 100GB
min_wal_size = 20GB

# CHECKPOINT TUNING (Reduce I/O spikes during high-volume indexing)
checkpoint_timeout = 15min
checkpoint_completion_target = 0.9

# MEMORY MANAGEMENT
# Memory for decoding transactions before spilling to disk (per slot)
logical_decoding_work_mem = 128MB
# Caching data: typically 25% of total system RAM
shared_buffers = 16GB             # Example for a 64GB RAM VPS
# Individual query memory; increase for complex blockchain analytics
work_mem = 64MB
maintenance_work_mem = 2GB        # Speed up VACUUM and index creation

# AUTOVACUUM PERFORMANCE
autovacuum = on
autovacuum_max_workers = 5        # More workers for 14 schemas
autovacuum_vacuum_scale_factor = 0.05 # Trigger vacuuming after 5% table change
autovacuum_vacuum_cost_limit = 1000   # Allow vacuum to use more I/O

# ADDITIONAL OPTIMIZATIONS (From existing docker-compose)
wal_buffers = 64MB
synchronous_commit = off
archive_mode = off
